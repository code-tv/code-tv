<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript">
        window.onload = function () {
            // ws client
            function endsWith(str, suffix) {
                return str.indexOf(suffix, str.length - suffix.length) !== -1;
            }
            /**
             * Get application root uri with ws/wss protocol.
             *
             * @returns {string}
             */
            function getRootUri() {
                let uri = "ws://" + (document.location.hostname == "" ? "localhost" : document.location.hostname) + ":" +
                    (document.location.port == "" ? "8080" : document.location.port);
                const pathname = window.location.pathname;
                if (endsWith(pathname, "/index.html")) {
                    uri = uri + pathname.substring(0, pathname.length - 11);
                } else if (endsWith(pathname, "/")) {
                    uri = uri + pathname.substring(0, pathname.length - 1);
                }
                return uri;
            }

            const wsUri = getRootUri() + "/";

            function onMessage(evt) {
                const msg = JSON.parse(evt.data);
                console.log(msg);
                switch (msg.type) {
                    case "ping":
                        console.log("ping");
                        break;
                }
            }

            // semi-permanent connection
            function onClose(evt) {
                window.setTimeout(connect, 1000);
            }

            function connect() {
                console.info("wsUri: " + wsUri);
                const websocket = new WebSocket(wsUri);
                websocket.onmessage = function (evt) {
                    onMessage(evt)
                };
                websocket.onclose = function (evt) {
                    onClose(evt);
                };
                websocket.onopen = function (evt) {
                    console.info("onopen");
                };
            }

            connect();

//            setInterval(function () {
//                console.info('Waiting...');
//            }, 1000);
        };

    </script>
    <script type="text/javascript" src="http://canvasjs.com/assets/script/canvasjs.min.js"></script>

    <script src="//code.jquery.com/jquery-1.12.3.js"></script>
    <script src="https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.12/js/dataTables.bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-dateFormat/1.0/jquery.dateFormat.min.js"></script>

    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.10.12/css/dataTables.bootstrap.min.css" rel="stylesheet">

    <style>
        #table {
            width: 80%;
        }

        a {
            font-family: monospace;
        }
    </style>

</head>
<body>

</body>
</html>
